\documentclass[10pt,a4paper,final]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[main=portuguese, english]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{scrbase}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\small,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,
    frame=single,
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\newcaptionname{portuguese}{\lstlistingname}{Listagem}
\newcaptionname{portuguese}{\lstlistlistingname}{Listagens}


\lstset{style=mystyle}
\lstset{literate=
  {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
  {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
  {à}{{\`a}}1 {è}{{\`e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
  {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
  {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
  {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
  {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
  {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
  {ã}{{\~a}}1 {ẽ}{{\~e}}1 {ĩ}{{\~i}}1 {õ}{{\~o}}1 {ũ}{{\~u}}1
  {Ã}{{\~A}}1 {Ẽ}{{\~E}}1 {Ĩ}{{\~I}}1 {Õ}{{\~O}}1 {Ũ}{{\~U}}1
  {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
  {ű}{{\H{u}}}1 {Ű}{{\H{U}}}1 {ő}{{\H{o}}}1 {Ő}{{\H{O}}}1
  {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
  {€}{{\euro}}1 {£}{{\pounds}}1 {«}{{\guillemotleft}}1
  {»}{{\guillemotright}}1 {ñ}{{\~n}}1 {Ñ}{{\~N}}1 {¿}{{?`}}1 {¡}{{!`}}1 
}



\author{Cristhian Grundmann}
\title{Visualização de curvas e superfícies a partir de geodésicas}


\begin{document}

\maketitle

%\tableofcontents
%\lstlistoflistings
%\listoffigures
%\listoftables

\section{Processamento da descrição de objetos}
O processamento da descrição de objetos é feito nas seguintes etapas:

\begin{enumerate}
	\item Descrição textual dos objetos numa gramática formal
	\item Leitura da descrição e produção de uma estrutura de dados adequada
	\item Geração automática de objetos auxiliares
	\item Passadas de reescrita, expandindo funções e calculando derivadas
	\item Compilação das estruturas em código de máquina
\end{enumerate}

\subsection{Gramática de descrição}
A gramática permite a declaração de 8 tipos de objeto: parâmetro, curva, superfície, definição, função, grade, ponto e vetor.

Os objetos podem fazer referência apenas a objetos definidos anteriormente, porém apenas pontos e vetores podem se referir a grades, diretamente ou indiretamente.

A gramática descreve duas estruturas principais: as declarações dos objetos(\texttt{DECL}) e as expressões matemáticas(\texttt{ADD}). As declarações têm estrutura simples, já as expressões são mais complexas.

A gramática das expressões matemáticas é mais especial quando comparada às linguagens de programação gerais, pois o domínio desse projeto é muito mais limitado. As partes não usuais são:

\begin{itemize}
\item Multiplicação justaposta: \texttt{2 x y z}
\item Função sem parênteses: \texttt{sin -x}
\item Recíproco unário: \texttt{/x = 1/x}
\item Múltiplicação unária(sem efeito): \texttt{*x = x}
\item Potenciação e derivação em funções: \texttt{f\textasciicircum 2 x}, \texttt{sin' x}
\end{itemize}

\newpage
\lstinputlisting[caption=Gramática completa]{grammar.txt}

\subsection{Parsing da descrição}
Há um pequeno detalhe a ser notado antes de se fazer o \textit{parsing} da descrição: não é possível determinar se um lexema como \texttt{k} forma um token do tipo \texttt{var\_id}, \texttt{func\_id} ou \texttt{id}. Isso é um problema pois a expressão \texttt{k 2} pode representar uma multiplicação ou uma aplicação de função, dependendo do tipo de \texttt{k}. A declaração do objeto determina seu tipo, então a análise léxica(que lê o texto e produz tokens adequados) e a análise sintática(que lê a sequência de tokens e produz uma estrutura de dados) deverão trabalhar em sincronia. O lexer e o parser devem compartilhar uma \textit{tabela de símbolos}, indicando quais símbolos(identificadores) estão definidos e quais são seus tipos. Quando o parser termina de processar a declaração de \texttt{k}, ele o põe na tabela de símbolos com o tipo adequado. Durante a leitura da declaração, o lexer lia \texttt{k} como um token do tipo \texttt{id}, que serve para indicar um símbolo novo. Depois da declaração, o lexer passará a ler \texttt{k} como \texttt{var\_id} ou \texttt{func\_id}, dependendo da declaração.

Para processar uma declaração de função \texttt{f}, a lista de argumentos é uma sequência de tokens do tipo \texttt{id}. Ao ler um argumento, o parser o coloca na tabela de símbolos como \texttt{var\_id}, impedindo a repetição de argumentos e possibilitando a referência no corpo da função. Após a declaração, os símbolos que serviram como argumento são removidos da tabela, pois são dummies.

O método de parsing usado é o recursive descent, onde cada não-terminal é uma rotina que lê uma sentença de seu tipo. Essas rotinas possuem efeitos colaterais, por isso não são chamadas de funções. Por exemplo, a rotina \texttt{FACT} examina o token atual e consegue determinar qual produção gramatical deve ser utilizada. Caso seja \texttt{TUPLE}, sua rotina é chamada para ler uma tupla. Caso seja outra produção, a rotina consome e processa o token, mandando o lexer passar para o próximo.

Para processar uma sentença \texttt{ADD}, deve-se ler uma sentença \texttt{MULT} e continuar lendo mais sentenças enquanto houver um dos sinais + ou -.

\newpage
\lstinputlisting[caption=Leitura de ADD]{pseudocode.txt}


\end{document}